{% extends "base.html"%}
{% block pagetitle %}
用户列表
{% endblock%}

{% block main %}
<div class="row">
  <div class="col-md-12 col-sm-12 col-xs-12">
    <div class="x_panel">
      <div class="x_title">
        <h2>列表详情</h2>
        <ul class="nav navbar-right panel_toolbox">
          <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
          </li>
          <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><i class="fa fa-wrench"></i></a>
            <ul class="dropdown-menu" role="menu">
              <li><a href="#">Settings 1</a>
              </li>
              <li><a href="#">Settings 2</a>
              </li>
            </ul>
          </li>
          <li><a class="close-link"><i class="fa fa-close"></i></a>
          </li>
        </ul>
        <div class="clearfix"></div>
      </div> <!-- x_title -->
      <div class="x_content">
        <p class="text-muted font-13 m-b-30">
          列表详情
        </p>
        <br>
        <!-- 用户列表 表格 -->
        <table id="datatable" class="table table-striped table-bordered">
          <thead>
            <tr>
              <th class="text-center">用户名</th>
              <th class="text-center">中文名</th>
              <th class="text-center">角色</th>
              <th class="text-center">邮箱</th>
              <th class="text-center">手机</th>
              <th class="text-center">状态</th>
              <th class="text-center">操作</th>
            </tr>
          </thead>

          <tbody>
          {% for user in users %}
            <tr>
              <td class="text-center">{{user.name}}</td>
              <td class="text-center">{{user.name_cn}}</td>
              {% if user.role == "admin" %}
                <td class="text-center">管理员</td>
              {% else%}
                <td class="text-center">普通用户</td>
              {% endif %}
              <td class="text-center">{{user.email}}</td>
              <td class="text-center">{{user.mobile}}</td>
              {% if user.status == 0 %}
                <td class="text-center" style="color:limegreen">正常</td>
              {% else %}
                <td class="text-center" style="color:indianred">锁定</td>
              {% endif %}
              <td class="text-center">
                <!-- 更新信息button -->
                <button type="button" class="btn btn-info update" data-toggle="modal" data-target="#chinfoModal">更新</button>
                <!-- 删除用户button -->
                <button  data-id="{{user.id}}" type="button" class="btn btn-danger del">删除</button>
              </td>
            </tr>
          {% endfor %}
          </tbody>
        </table>
        <!-- /用户列表 表格 -->

      </div> <!-- x_content -->
    </div> <!-- x_panel -->
  </div>
</div> <!-- row -->

{% endblock %}

{% block js %}
<script>
// datetable中文配置
$('#datatable').dataTable({
        "bDestroy":true, //一旦datatable的数据有增加或者删除，会销毁原有的，重新获取
        "language": {
                "lengthMenu": "每页 _MENU_ 条记录",
                "zeroRecords": "没有找到记录",
                "sInfo": "第 _PAGE_ 页 ( 总共 _PAGES_ 页 )",
                "infoEmpty": "无记录",
                "infoFiltered": "(从 _MAX_ 条记录过滤)",
                "sSearch": "搜索:",
                "oPaginate": {
                "sFirst": "首页",
                "sPrevious": "上一页",
                "sNext": "下一页",
                "sLast": "末页"
                }
        },
        "order": [[ 1, "asc" ]]
});

// 删除用户
$('.del').on("click",function(){  //更新密码不能通过ID选择器，因为做了for循环，只能通过class里定义的类del来做
  var user_id =  $(this).attr('data-id')
  var url = "/user/delete?id=" + user_id
  if(confirm("确认删除？")){
    $.getJSON(url,function(data){
      console.log(data)  //打印调试
      if (data['code'] == 0){
        swal({
          title: "",
          text: "successful",
          type:"success",
          confirmButtonText:"确定"
        }, function(){
          location.reload()
        })
      }else{
        swal({
          title: "",
          text: "error",
          type:"error",
          confirmButtonText:"确定"
        })
      }
    })
  }
})

</script>
{% endblock %}

